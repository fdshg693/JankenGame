@page "/janken"
@rendermode InteractiveServer

<h3>じゃんけんゲーム</h3>

<div class="choices">
    <button @onclick="() => Play(JankenHand.Rock)">✊  グー</button>
    <button @onclick="() => Play(JankenHand.Paper)">✋  パー</button>
    <button @onclick="() => Play(JankenHand.Scissors)">✌️  チョキ</button>
</div>

@if (Player.Hand != null && Computer.Hand != null)
{
    <div class="result">
        <p>あなた：@Player.Hand?.GetDescription() → コンピューター：@Computer.Hand?.GetDescription()</p>
        <p>@OutcomeMessage</p>
        <p>＜現在のスコア＞ あなた：@UserScore ／ コンピューター：@ComputerScore</p>
        <button @onclick="ResetGame">リセット</button>
    </div>
}

@code {
    int UserScore = 0, ComputerScore = 0;
    string OutcomeMessage = "";

	JankenPlayer Player = new JankenPlayer();
	JankenPlayer Computer = new JankenPlayer();

    Random rnd = new();

    void Play(JankenHand userJankenHand)
    {
        Player.Hand = userJankenHand;
        Computer.Hand = (JankenHand)rnd.Next(0, 3);
        DetermineWinner();
    }

    void DetermineWinner()
    {
        if (Player.Hand == Computer.Hand)
        {
            OutcomeMessage = "引き分け！";
        }
        else if (
            (Player.Hand == JankenHand.Rock && Computer.Hand == JankenHand.Scissors) ||
            (Player.Hand == JankenHand.Paper && Computer.Hand == JankenHand.Rock) ||
            (Player.Hand == JankenHand.Scissors && Computer.Hand == JankenHand.Paper)
        )
        {
            OutcomeMessage = "あなたの勝ち！🎉";
            UserScore++;
        }
        else
        {
            OutcomeMessage = "コンピューターの勝ち...";
            ComputerScore++;
        }
    }

    void ResetGame()
    {
        UserScore = 0;
        ComputerScore = 0;
		Player = new JankenPlayer();
		Computer = new JankenPlayer();
        OutcomeMessage = "";
	}
}
